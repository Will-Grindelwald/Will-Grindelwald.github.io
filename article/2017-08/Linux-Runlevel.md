---
title: Linux 运行级别
date: 2017-08-13
categories:
- Linux
- 运维
tags:
- 运维
- 运行级别
---

Linux 运行级别介绍 及 修改 CentOS、Ubuntu 的运行级别

<!-- more -->

## 1. Linux系统中的运行级别

### 1.1 7种运行级别

运行级别(Runlevel)指的是 Unix 或者 Linux 等类 Unix 操作系统的运行模式, 不同的运行模式下系统的功能也有所有不同. Linux 系统下通常分为`7`种运行级别, 分别是从`0`到`6`. 各级别介绍如下:

* `0` - 停机模式. 在这种模式下, 系统处于停机状态, 系统默认运行级别不能设为 `0` , 否则将不能正常启动这个运行级别主要用于关闭任务, 在`/etc/rc0.d`目录下的各个连接命令都是此级别的命令, 在关闭系统时, 这些命令将被逐个执行. 它们会杀掉所有进程、关闭虚拟内存和交换文件、卸载文件系统和交换分区.
* `1` - 单用户模式. 在这种运行模下, 系统处于单用户工作状态, 登录用户具有 `root` 权限, 文件系统被加载但是网络却没有被加载, 因此也无法远程登陆. 这个运行级别, 只允一个用户从本地计算机上登录, `/etc/rc1.d`目录下的所有文件与此运行级别相关连, 这个运行级别一般用于系统管理与维护.
* `2` - 多用户模式. 用户可以通过网络进行登录, 但没有`NFS`(Network File System), 即网络文件系统. `/etc/rc2.d`目录下所有文件与此级别相连.
* `3` - 完全多用户模式. 用户可以通过网络进行登录, 且有`NFS`, 用户登陆后会进入控制台命令行模式. 这也是缺省的运行模式, 在这种运行级别下所有网络服务程序会一起运行. `/etc/rc2.d`录下的文件与此级别相连
* `4` - 自定义模式. 这是一种系统未使用的保留模式, `/etc/rc4.d`目录与此级别相连. 这一级别是用户自定义的运行级别, 用户可以根自己的需要进行一些自定义设置. 如果想要运行这一级别的话, 必须在`rc3.d`目录下放入连接文件, 就像其他`rc*.d`目录下的文件, 并指明是启动还是终止进程.
* `5` - 图形化模式. 在 Linux 下运行`X Window`就是使用这一运行级别, 用户登录后将进入图形化的 GUI 界面. 在这一级别下除了 DNS 的`named`与级别`3`不同, 其余的都相同.
* `6` - 重启模式. 系统正常关闭并重启, 默认运行级别不能设为`5`, 否则系统将不能正常启动. `/etc/rc6.d`目录与此级别相连. 在这一运行级别下, 不会关闭电源, `/etc/rc6.d`目录下的连接与`rc0.d`目录下的连接基本相同；不同之处在于, 虽然它们都执行`halt`(关闭)命令, 但是给`halt`传递的参数不同, 所级别`6`会重新启动系统而`0`会关闭系统.

**注意:** 以上适用于 `CentOS` 等发行版, 而对于 `Ubuntu` 等 `debian` 系的 Linux 来说, `2~5` 都是多用户图形模式, 几个运行模式没有区别.

### 1.2 不同运行级别的实现原理

如上所述, Linux 系统的每一个运行级别, 都对应一个目录.

在`/etc/init.d`目录下有许多脚本程序, 我们将这些程序称之为服务(`Service`).

而`/etc`目录下, 还有`rc0.d`~`rc6.d`共7个目录. 在这些目录下都是一些软链接文件, 这些链接文件都指向了`init.d`目录下的`service`脚本文件. 而这些软连接的命名规则为: `K+nn+服务名`或`S+nn+`服务名, 其中`nn`为两位数字.

系统启动时, 会根据当前运行级别进入对应的`rc*.d`目录, 然后按照文件名顺序检索目录下的链接文件, 并会做以下处理:

* 对于以`K`开头的文件, 系统将终止对应的服务
* 对于以`S`开头的文件, 系统将启动对应的服务

注意: `/etc/init.d`存在于 Ubuntu 等发行版中, 而 CentOS 等发行版中位于`/etc/rc.d/init.d`目录下, 但通过`/etc/init.d`软连接进行关联. 同样的, `rc*.d`等目录, 在 Ubuntu 等系统中位于`/etc/`目录下, 而在 CentOS 等系统中位于`/etc/rc.d`目录下, 但在`/etc`下都有对应的软连接.

## 2. 运行级别相关命令

### 2.1 systemctl 命令

现在 `Ubuntu 16.04` 和 `CenosOS 7` 都采用 systemd 了, 改 /etc/inittab 的方法失效了, init 命令 本人不推荐, 使用 systemctl.

查看当前启动模式:

```bash
$ systemctl get-default
graphical.target
```

修改默认运行级别:

```bash
systemctl set-default multi-user.target
```

输入密码完成修改. 重启后, 系统默认将以级别`3`启动.

修改当前运行级别(临时):

```bash
systemctl isolate graphical.target # 切换到 图形级别
systemctl isolate multi-user.target # 切换到 命令行级别
```

### 2.2 init 命令

查看系统当前运行级别: `runlevel`

```bash
$ runlevel
3 5
```

切换系统运行级别: `init N`. 如, 切换到 `3` 多用户命令模式:

```bash
init 3
```

常用的`init`命令还有: `init 0`结束所有进程后关闭计算机、`init 6`重启系统

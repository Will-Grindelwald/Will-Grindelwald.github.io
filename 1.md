# 建站

因为不是专业的前端人员, 最终选择了使用 Github Pages + Hexo 作我的博客系统。

## 1 服务器 & 域名 & DNS & CDN

服务器: 目前使用 [Github Pages](https://pages.github.com/), 可选阿里云、腾讯云。

域名: 世界最大域名商 GoDaddy, 但良心的支持中文和支付宝(还可以 google "GoDaddy 优惠码"), 可选阿里云、腾讯云。

DNS: 可选阿里云、腾讯云、[DNSpod](https://www.dnspod.cn/)、新网

CDN: 可选阿里云、腾讯云、百度云加速

图床: 加速乐、七牛云存储、又拍云

PS: 添加域名解析:

1. 获得服务器 IP;
1. 到 DNS 解析商添加域名(从域名商处购得), 并添加 "A 记录";
1. 再到域名商管理域名, 修改域名 DNS 服务器(Set NameServers), 改为 DNS 商提供的 DNS 地址

大体流程如此, 根据你的云服务器商、域名商、DNS 商不同, 具体问题具体分析。

**具体到我这次的配置**

* Github Pages 作 服务器
* 阿里云 的 域名 & DNS

设置就比较简单了

* 在用作服务器的 Github Repo 的 settings -> Options -> GitHub Pages -> Custom domain 中 添加你的域名的 WWW 子域名, 如我的: www.lyogvce.me
* 在 DNS 解析商添加解析
    * CNAME www XXX.github.io
    * A @ 192.30.252.153
    * A @ 192.30.252.154

即可。

参考:

* https://help.github.com/articles/using-a-custom-domain-with-github-pages/
* https://help.github.com/articles/about-supported-custom-domains/
* https://help.github.com/articles/setting-up-an-apex-domain-and-www-subdomain/

## 2 Hexo 安装

前置: 需要安装 [node](https://nodejs.org/zh-cn), [git](https://git-scm.com/).

```sh
# 安装 hexo
$ npm install hexo-cli -g
# 在当前目录下创建子目录 /blog, 并初始化为 hexo 工作目录 或 将当前目录初始化为 hexo 工作目录 `$ hexo init`
$ hexo init blog
$ cd blog
$ npm install
```

常用命令:

* hexo new [post] "new article name" (hexo n [post] "new article name") 使用 post 模板(默认为 post, 模板文件在 `/scaffolds`)新建一篇文章
* hexo generate (hexo g) 生成静态文件, 会在当前目录下生成一个新的叫做 public 的文件夹
* hexo server (hexo s) 启动本地 web 服务, 用于博客的预览
* hexo deploy (hexo d) 部署博客到远端(比如 github, heroku 等平台)
* hexo clean 清除缓存文件 (db.json) 和已生成的静态文件 (public), 在修改过界面后先清空再重新生成

## 3 Hexo 配置

### 3.1 CNAME

一般来说, 若是在 DNS 商处添加了 CNAME 记录, 需要在网站根目录下添加 `CNAME` 文件, 内容为你的 CNAME 记录的那个域, 如: `www.lyogvce.me`

但若是用 Github Pages 作服务器, 应该在对应项目 Github Repo 的 settings -> Options -> GitHub Pages -> Custom domain 中 添加你的域名的 WWW 子域名, 如我的: www.lyogvce.me, 设置完 Github 会自动创建 CNAME 文件。若是 XXX.github.io 项目设置了 yourDomain.com, 其余项目的 Github Pages 将自动使用 yourDomain.com/repoName 而不再是 XXX.github.io/repoName(其余项目若也有设置则用项目自己的设置)。

我是以 XXX.github.io 作为我的个人主页, XXX.github.io/Blog 作为 博客主页, 只在 XXX.github.io 项目设置 Custom domain(CNAME) 即可。

### 3.2 修改 permalink

hexo 默认的 permalink 配置是:

```yml
permalink: :year/:month/:day/:title/
```

这样生成的访问链接都是类似 http://yoursite.com/2016/05/06/your_title/ 这样的, 有点动态网站的风格, 不过这样可能对于搜索引擎不是太友好, 我们可以把 permalink 修改成 `.html` 结尾的, 我的修改如下

```yml
permalink: :year-:month/:title.html
```

还有一点需要注意的是, title 最好是英文的, 这样 permalink 也是不带中文的, 但是 markdown 文件中的 title 你还是可以按自己的文章标题写成中文的。

### 3.3 使用 hexo deploy 部署到 github

安装上扩展即可

```sh
npm install hexo-deployer-git --save
```

### 3.4 404 公益页面

GitHub Pages 有提供制作 404 页面的指引: [Custom 404 Pages](https://help.github.com/articles/custom-404-pages)。

直接在根目录下创建自己的 404.html 或者 404.md 就可以。但是自定义 404 页面仅对绑定顶级域名的项目才起作用, GitHub 默认分配的二级域名是不起作用的。

我用的是 [腾讯公益 404](http://www.qq.com/404/)。

### 3.5 修改分页设置

```yml
# 将原来的这两条注释掉
# per_page: 10
# pagination_dir: page

index_generator:
  per_page: 7
category_generator:
  per_page: 20
archive_generator:
  per_page: 100
  yearly: true
  monthly: true
tag_generator:
  per_page: 20
```

### 3.6 静态资源优化

主要是压缩 html, css, js, 图片 等静态资源, 可以适当减少请求的数据量, 主要用到`gulp`和一些相关的插件来实现, 安装:

```sh
npm install gulp gulp-load-plugins gulp-htmlclean gulp-htmlmin gulp-uglify gulp-clean-css gulp-cache gulp-imagemin imagemin-pngquant gulp-concat gulp-csscomb pump -g
npm install gulp gulp-load-plugins gulp-htmlclean gulp-htmlmin gulp-uglify gulp-clean-css gulp-cache gulp-imagemin imagemin-pngquant gulp-concat gulp-csscomb pump --save
```

然后添加`gulpfile.js`到根目录。

```js
var gulp = require('gulp'),
    // pngquant = require('imagemin-pngquant'), // 深度压缩
    // plugins = require('gulp-load-plugins')();
htmlclean = require('gulp-htmlclean'),
htmlmin = require('gulp-htmlmin'),       // 压缩 HTML
csscomb = require('gulp-csscomb'),       // CSS 格式化
cleancss = require('gulp-clean-css'),    // 压缩 CSS
uglify = require('gulp-uglify'),         // 压缩 JS
cache = require('gulp-cache'),           // 缓存
imagemin = require('gulp-imagemin'),     // 压缩 图片
pngquant = require('imagemin-pngquant'), // 深度压缩
concat = require('gulp-concat');
// 压缩 html
gulp.task('minify-html', function () {
    return gulp.src('./public/**/*.html')
        .pipe(htmlclean())
        .pipe(htmlmin({
            removeComments: true,                // 清除 HTML 注释
            collapseWhitespace: true,            // 压缩 HTML
            collapseBooleanAttributes: true,     // 省略布尔属性的值 <input checked="true"/> ==> <input checked />
            removeEmptyAttributes: true,         // 删除所有空格作属性值 <input id="" /> ==> <input />
            removeRedundantAttributes: true,     // 当值是默认时删除属性
            removeScriptTypeAttributes: true,    // 删除 <script> 的 type="text/javascript"
            removeStyleLinkTypeAttributes: true, // 删除 <style> 和 <link> 的 type="text/css"
            minifyJS: true,                      // 压缩页面 JS
            minifyCSS: true,                     // 压缩页面 CSS
            minifyURLs: true,                    // Minify URLs in various attributes (uses relateurl)
            useShortDoctype: true                // Replaces the doctype with the short (HTML5) doctype
        }))
        .on('error', function (err) {
            console.log('html Error!', err.message);
            this.end();
        })
        .pipe(gulp.dest('./public'))
});
// 压缩 css
gulp.task('minify-css', function () {
    return gulp.src(["public/**/*.css", "!public/**/*.min.css"])
        .pipe(csscomb())
        .pipe(cleancss({
            advanced: false,         // 类型: Boolean 默认: true [是否开启高级优化(合并选择器等)]
            keepSpecialComments: '1' // 保留所有特殊前缀 当你用 autoprefixer 生成的浏览器前缀, 如果不加这个参数, 有可能将会删除你的部分前缀
        }))
        .pipe(gulp.dest('./public'));
});
// 压缩 js
gulp.task('minify-js', function () {
    return gulp.src(['./public/js/**/*.js', '!public/js/**/*.min.js'])
        .pipe(uglify({
            mangle: true,  // 类型: Boolean 默认: true 是否修改变量名
            compress: true // 类型: Boolean 默认: true 是否完全压缩
        }))
        // .pipe(concat('all.js')) //合并后的文件名
        // .pipe(gulp.dest('./public/js'));
        .pipe(gulp.dest('./public'));
});
//压缩 图片
gulp.task('imagemin', function () {
    return gulp.src('./public/**/*.{png,jpg,gif,ico}')
        // 只压缩修改的图片。压缩图片时比较耗时, 在很多情况下我们只修改了某些图片, 没有必要压缩所有图片, 使用"gulp-cache"只压缩修改的图片, 没有修改的图片直接从缓存文件读取(%TMP%\gulp-cache)。
        .pipe(cache(imagemin({
            progressive: true,    // 类型: Boolean 默认: false 无损压缩 jpg 图片
            optimizationLevel: 5, // 类型: Number 默认: 3 取值范围: 0-7(优化等级)
            interlaced: true,     // 类型: Boolean 默认: false 隔行扫描 gif 进行渲染
            multipass: true,      // 类型: Boolean 默认: false 多次优化 svg 直到完全优化
            svgoPlugins: [{ removeViewBox: false }], // 不要移除 svg 的 viewbox 属性
            use: [pngquant()]     // 使用 pngquant 深度压缩 png 图片的 imagemin 插件
        })))
        .pipe(gulp.dest('./public'));
});
// 默认任务
gulp.task('default', [
    'minify-html', 'minify-css', 'minify-js', 'imagemin'
]);
```

以后 generate 的时候跟上 gulp 命令即可压缩静态资源。

```sh
hexo g
gulp
hexo d
```

## 4 Hexo 主题配置

我使用的 next 主题

```sh
$ git clone https://github.com/iissnan/hexo-theme-next themes/next
# 修改 Hexo 目录下的 _config.yml 配置文件中的 theme 属性, 将其设置为 next
$ hexo clean
$ hexo g # 重新生成
```

### 4.1 修改 Scheme

在主题配置文件 _config.yml 中修改

```yml
# Schemes
#scheme: Muse
scheme: Mist
#scheme: Pisces
```

### 4.2 设置 基本信息

#### 1 页面图标

在主题配置文件 _config.yml 中修改

```yml
# 页面图标
favicon: /images/favicon.ico
```

#### 2 侧边栏头像

在主题配置文件 _config.yml 中, 修改

```yml
# Sidebar Avatar 头像
avatar: /images/profile.png
```

添加头像动画: 鼠标经过旋转 360 度, 修改 themes/next/source/css/_common/components/sidebar/sidebar-author.styl

```styl
.site-author-image {

  ……

  /* 添加如下内容 */
  /* 头像圆形 */
  border-radius: 50%;
  -webkit-border-radius: 50%;
  -moz-border-radius: 50%;

  /* 鼠标经过头像旋转 360 度 */
  -webkit-transition: -webkit-transform 1.5s ease-out;
  -moz-transition: -moz-transform 1.5s ease-out;
  transition: transform 1.5s ease-out;
}

img:hover {
  /* 鼠标经过头像旋转 360 度 */
  -webkit-transform: rotateZ(360deg);
  -moz-transform: rotateZ(360deg);
  transform: rotateZ(360deg);
}
```

#### 3 作者昵称

在站点配置文件 _config.yml, 设置 author 为你的昵称。

#### 4 站点描述

在站点配置文件 _config.yml, 设置 description 字段为你的站点描述。站点描述可以是你喜欢的一句签名:)

修改 站点描述信息颜色, themes/next/source/css/_variables/custom.styl

```styl
// 站点描述信息颜色
$site-description-color = $whitesmoke
```

PS: 主题配置文件 _config.yml 若设置 `seo: false`, 会导致站点描述信息不显示

```yml
# Change headers hierarchy on site-subtitle (will be main site description) and on all post/pages titles for better SEO-optimization.
# 设置了 true 站点描述信息会不显示
seo: false
```

#### 5 站点建立时间

在主题配置文件 _config.yml 中, 修改

```yml
# 网站起始时间
since: 2016
```

#### 6 版权信息

在主题配置文件 _config.yml 中, 修改

```yml
# 每篇文章末尾声明版权信息
# Declare license on posts
post_copyright:
  enable: true
  license: CC BY-NC-SA 3.0
  license_url: https://creativecommons.org/licenses/by-nc-sa/3.0/
```

#### 7 其他

在主题配置文件 _config.yml 中, 修改

```yml
# Footer `powered-by` and `theme-info` copyright
# 页脚是否显示 `由 Hexo 强力驱动  主题 - NexT.Mist`
copyright: false

# ---------------------------------------------------------------
# SEO Settings 待探索
# ---------------------------------------------------------------

# Canonical, set a canonical link tag in your hexo, you could use it for your SEO of blog.
# See: https://support.google.com/webmasters/answer/139066 <-- 看它
# Tips: Before you open this tag, remember set up your URL in hexo _config.yml ( ex. url: http://yourdomain.com )
canonical: true

# Change headers hierarchy on site-subtitle (will be main site description) and on all post/pages titles for better SEO-optimization.
# 设置了 true 站点描述信息会不显示
seo: false

# If true, will add site-subtitle to index page, added in main hexo config.
# subtitle: Subtitle # 这条配置项在站点配置文件 _config.yml
index_with_subtitle: true

……

# 侧边栏下部的权限信息 - 冗余、不美观, 去掉
# Creative Commons 4.0 International License.
# http://creativecommons.org/
# Available: by | by-nc | by-nc-nd | by-nc-sa | by-nd | by-sa | zero
#creative_commons: by-nc-sa
```

### 4.3 侧边栏添加 社交链接 & RSS(feed) 链接 & 友情链接

#### 1 侧边栏社交链接

在主题配置文件 _config.yml 中, 修改字段 `social`, 添加社交站点名称(注意大小写)与地址, 如:

```yml
# Social links
social:
  GitHub: https://github.com/your-user-name
  Twitter: https://twitter.com/your-user-name
  Weibo: http://weibo.com/your-user-name
  douban: http://douban.com/people/your-user-name
  zhihu: http://www.zhihu.com/people/your-user-name
  # 等等
```

在主题配置文件 _config.yml 中, 修改字段 `social_icons`, 添加社交站点名称(注意大小写)与图标, 如:

```yml
social_icons:
  enable: true
  # Icon Mappings.
  # KeyMapsToSocalItemKey: NameOfTheIconFromFontAwesome
  GitHub: github
  Twitter: twitter
  Weibo: weibo
  Linkedin: linkedin
```

图标名称可以参考: http://fontawesome.io/cheatsheet/

#### 2 侧边栏 RSS(feed) 链接

安装 hexo-generator-feed

```sh
npm install hexo-generator-feed --save
```

若是使用 next 主题, 这样即可, 不用下面的配置

非 next 主题, 还要配置插件, 在站点配置文件 _config.yml 中添加

```yml
# Extensions
## Plugins: http://hexo.io/plugins/
plugin:
#RSS订阅
- hexo-generator-feed
#Feed Atom
feed:
  type: atom
  path: atom.xml
  limit: 20
```

##### 填坑

一开始用的很好, 忽然有一天挂了！打开 RSS 页面的时候显示

```txt
This page contains the following errors:
error on line 28 at column 109: Input is not proper UTF-8, indicate encoding !
Bytes: 0x08 0xE5 0xA4 0x9A
Below is a rendering of the page up to the first error.
```

根据错误提示, 用编辑器打开 `public` 目录下 的`rss.xml` 或 `atom.xml`。找到第 28 行 109 列, 是这样的内容:

```xml
反复推敲代码"></a>反复推敲代码</h2><p>既然 “天……………………
                                 ^这个位置
```

解决办法:

1. 找到错误点所在的文章文件(不要只看报错的位置, 真正有问题的地方不一定在这), 搜索错误信息给出的有问题的 bytes, 用正则搜: \x08, 果然找到了几个特殊字符, 删掉即可
1. 重新生成: hexo clean & hexo g

出现这种问题主要是从网页上复制东西时复制到了 UTF-8 不可表示特殊字符了。

#### 3 侧边栏友情链接

在主题配置文件 _config.yml 中, 修改如下字段:

```yml
# 友链设置
# Blog rolls
links_title: Links
#links_layout: block
#links_layout: inline
links:
  MacTalk: http://macshuo.com/
  Title: http://example.com/
```

### 4.4 添加 "About Me"、分类、标签云 页面

添加一个 "About Me"、分类、标签云 页面, 并在菜单中显示页面链接。

#### Step 1 新建 "About Me"、分类、标签云 页面

```sh
hexo new page about
hexo new page categories
hexo new page tags
```

* 编辑 /source/about/index.md, 输入个人信息即可。
* 编辑 /source/categories/index.md, 主题将自动为这个页面显示所有分类。

   ```yml
   ---
   title: 分类
   date: 2014-12-22 12:39:04
   type: "categories"
   ---
   ```

* 编辑 /source/tags/index.md, 主题将自动为这个页面显示标签云。

   ```yml
   ---
   title: All tags
   date: 2014-12-22 12:39:04
   type: "tags"
   ---
   ```

注意: 如果有启用多说 或者 Disqus 评论, 这些页面也会带有评论。需要关闭的话, 请添加字段 comments 并将值设置为 false, 如:

```yml
# for /source/categories/index.md
---
title: 分类
date: 2014-12-22 12:39:04
type: "categories"
comments: false
---

# for /source/tags/index.md
---
title: All tags
date: 2014-12-22 12:39:04
type: "tags"
comments: false
---
```

#### Step 2 在菜单中添加链接

在主题配置文件 _config.yml 中, 修改如下:

```yml
menu:
  home: /
  categories: /categories/
  archives: /archives/
  tags: /tags/
  about: /about/
```

#### 区分: 分类和标签

在其他系统中, 分类和标签听起来很接近, 但是在 Hexo 中两者有着明显的差别: 分类具有顺序性和层次性, 也就是说 Foo, Bar 不等于 Bar, Foo; 而标签没有顺序和层次。

> 分类方法的分歧: 如果您有过使用 WordPress 的经验, 就很容易误解 Hexo 的分类方式。WordPress 支持对一篇文章设置多个分类, 而且这些分类可以是同级的, 也可以是父子分类。但是 Hexo 不支持指定多个同级分类。下面的指定方法
>
> ```yml
> categories:
> - Diary
> - Life
> ```
>
> 会使分类 Life 成为 Diary 的子分类, 而不是并列分类。因此, 有必要为您的文章选择尽可能准确的分类。

### 4.5 动画

#### 1 设置是否开启动画效果

NexT 默认开启动画效果, 效果使用 JavaScript 编写, 因此需要等待 JavaScript 脚本完全加载完毕后才会显示内容。 如果您比较在乎速度(主要是指页面加载时的动画, 不是背景动画), 可以将设置此字段的值为 `false` 来关闭动画。

在主题配置文件 _config.yml 中, 修改 `use_motion`, 根据您的需求设置值为 `true` 或者 `false` 即可:

```yml
use_motion: true  # 开启动画效果
use_motion: false # 关闭动画效果
```

#### 2 设置背景动画

NexT 自带两种背景动画效果: `canvas_nest` 和 `three_waves`。

在主题配置文件 _config.yml 中, 修改 `canvas_nest` 或 `three_waves`, 根据您的需求设置值为 `true` 或者 `false` 即可(只能同时开启一种背景动画效果):

```yml
# canvas_nest
canvas_nest: true  # 开启动画
canvas_nest: false # 关闭动画

# three_waves
three_waves: true  # 开启动画
three_waves: false # 关闭动画
```

### 4.6 本人的个性化修改

#### 1 侧边栏目录不自动添加编号

在主题配置文件 _config.yml 中, 修改

```yml
toc:
  # Automatically add list number to toc. 目录自动编号, 我一般自己编号, 去掉
  number: false
```

#### 2 修改字体 & 内容区域的宽度

1. http://theme-next.iissnan.com/theme-settings.html#fonts-customization
1. themes/next/source/css/_variables/custom.styl

   ```styl
   // 标题字体大小
   $font-size-headings-base = 30px

   // 正文字体大小
   $font-size-base = 16px

   // 代码字体大小
   $code-font-size = 16px

   // 内容区域宽度
   $content-desktop = 900px

   // 当视窗超过 1600px 后的宽度
   $content-desktop-large = 1100px
   ```

#### 3 返回顶部按钮优化

```yml
sidebar:

  ……

  # Scroll percent label in b2t button 在返回顶部按钮上添加滑动百分比
  scrollpercent: true

# Automatically scroll page to section which is under <!-- more --> mark.
# 不好
scroll_to_more: false
```

#### 3 优化中英文排版

安装 pangu.js

```sh
npm install pangu -save
```

新建 ``addSpace.js`

```js
#!/usr/bin/env node

var pangu = require('pangu'),
    fs = require("fs");

pangu.spacingFile(process.argv[2], function (err, data) {
    fs.writeFile(process.argv[2], data, function (err) {
        if (err) {
            return console.error(err);
        }
    });
});
```

使用: `./addSpace.js filename`

#### 4 改了一处翻译

themes/next/languages/zh-Hans.yml

```yml
menu:
  about: About Me
```

#### 5 修改模板

scaffolds/post.md

```md
---
title: {{ title }}
date: {{ date }}
categories:
tags:
---
```

#### 6 在首页只显示文章的摘要

按官方文档推荐的, 使用 `<!-- more -->`, 进行手动截断。优点: 在摘要中文章格式也会保持原样, 比使用 `auto_excerpt` 好。

### 4.7 集成其它服务

#### 1 打赏功能

在主题配置文件 _config.yml 中, 填入 微信 和 支付宝 收款二维码图片地址, 即可开启该功能。

```yml
reward_comment: 坚持原创技术分享, 您的支持将鼓励我继续创作！
wechatpay: /path/to/wechat-reward-image
alipay: /path/to/alipay-reward-image
```

#### 2 订阅微信公众号

在每篇文章的末尾显示微信公众号二维码, 扫一扫, 轻松订阅博客。

在微信公众号平台下载您的二维码, 并将它存放于博客 `source/uploads/` 目录下。

在主题配置文件 _config.yml 中, 修改

```yml
# Wechat Subscriber 公众号订阅功能
wechat_subscriber:
  enabled: true
  qcode: /uploads/wechat-qcode.jpg
  description: 欢迎您扫一扫上面的微信公众号, 订阅我的博客！
```

#### 3 评论系统

参考 [官方文档](http://theme-next.iissnan.com/third-party-services.html#comment-system)

~~我使用的 [网易云跟帖](https://gentie.163.com/)~~, 还没用两天, 告诉我要停止服务了/大哭

现在改用 来必力 了, 韩国的...... 我也很无奈啊

PS: [这篇文章](https://blog.shuiba.co/comment-systems-recommendation) 不错。

#### 4 数据统计

##### 1) 阅读次数统计

使用的是 [LeanCloud](https://leancloud.cn) 的服务

1. 注册 LeanCloud 帐号
1. 在控制台界面, 点击 `创建应用`, 输入应用名(随便)
1. 点击应用名, 进入了 `存储` 界面
1. 点击 `创建 Class`, 输入 Class 名称为 `Counter`, ACL 权限为 `无限制`
1. 点击 `设置` -> `应用 Key`, 取得 `App ID` 和 `App Key`, 并填入主题配置文件 _config.yml 中

```yml
leancloud_visitors:
  enable: true
  app_id: #<app_id>
  app_key: #<app_key>
```

PS.1: `存储` -> `Counter`, 即你的阅读量统计表, 可以修改 time 字段的数值来修改某一篇文章的访问量

PS.2: 点击 `设置` -> `安全中心`, 安全域名中填写 你的域名。(因为 AppID 以及 AppKey 是暴露在外的, 所以最好设置一下。缺点: 设置以后, 本地这个功能就不能用了, 只能部署到网上才能统计成功, 所以先调试好了再设置安全域名)

##### 2) 访客统计: 不蒜子

在主题配置文件 _config.yml 中, 修改

```yml
# Show PV/UV of the website/page with busuanzi.
# Get more information on http://ibruce.info/2015/04/04/busuanzi/
busuanzi_count:
  # count values only if the other configs are false
  enable: true
  # custom uv span for the whole site
  site_uv: true
  site_uv_header: <span id="visit" title="本站访客数"><i class="fa fa-user"></i>
  site_uv_footer: </span>
  # custom pv span for the whole site
  site_pv: true
  site_pv_header: <span id="visit" title="本站总访问量"><i class="fa fa-eye"></i>
  site_pv_footer: </span>
  # custom pv span for one page only
  page_pv: false
  page_pv_header: <i class="fa fa-file-o"></i>
  page_pv_footer:
```

修改 themes/next/source/css/_common/components/third-party/busuanzi-counter.styl

```styl
.site-uv,
.site-pv,
.page-pv {
  display: inline-block;

  .busuanzi-value {
    margin: 0 5px;
  }

  #visit:hover {
    color: black;
  }
}
```

##### 3) 站长工具

与 前两个 的装逼属性不同, 站长工具 是用于网站管理的: 添加 Google / 百度 / 腾讯 / CNZZ 统计

添加 Google / 百度 / 腾讯 / CNZZ 的统计 ID(http://theme-next.iissnan.com/third-party-services.html#analytics-baidu) 即可开启网站统计

在主题配置文件 _config.yml 中, 修改对应字段 (取决于使用的统计系统)。

```yml
baidu_analytics: your-analytics-id
google_analytics: your-analytics-id
tencent_analytics: your-analytics-id
cnzz_siteid: your-analytics-id
```

##### 4) 文章字数统计

安装 hexo-wordcount 插件

```sh
npm install hexo-wordcount --save
```

在主题配置文件 _config.yml 中, 修改

```yml
# Post meta display settings 文章元信息战展示设定
# 是否显示文字 创建于 更新于 分类
post_meta:
  item_text: true
  created_at: true
  updated_at: false
  categories: true

# 文章字数统计展示
# Post wordcount display settings
# Dependencies: https://github.com/willin/hexo-wordcount
# 是否显示文字 字数统计 阅读时长
post_wordcount:
  item_text: true # 页面上是否显示文字"字数统计""阅读时长"
  wordcount: true # 字数统计
  min2read: true  # 阅读时间
  separated_meta: false # 设为 false 才正常显示, 不知道为啥
```

#### 5 分享功能

##### 1) 百度分享

在主题配置文件 _config.yml 中, 修改字段 baidushare

```yml
# 百度分享服务
# Baidu Share
# Available value:
#    button | slide
# Warning: Baidu Share does not support https.
baidushare:
  type: button
```

##### 2) JiaThis

在主题配置文件 _config.yml 中,  修改字段 jiathis

```yml
# JiaThis 分享服务
# Share
jiathis: true
```

#### 6 站内搜索

首选 Local Search, 原理是通过 hexo-generator-searchdb 插件在本地生成一个 search.xml 文件, 搜索的时候从这个文件中根据关键字检索出相应的链接。

次选 第三方集成业务, 例如 Swiftype、Algolia, 美观程度可以, 但不免费, 其中 Algolia 的免费账户也可以用一下。

最差的是集成搜索引擎, 因为搜索结果取决于该搜索引擎对你站点的收录情况, 且与网站的主体风格不搭。

##### 配置 Local Search

1. 安装 `hexo-generator-searchdb` 插件:

   ```sh
   npm install hexo-generator-searchdb --save
   ```

1. 在站点配置文件 _config.yml 中, 任意位置新增以下内容(用于 [配置 hexo-generator-searchdb 插件](https://www.npmjs.com/package/hexo-generator-searchdb)):

   ```yml
   search:
     path: search.xml
     field: post
     format: html
     limit: 10000
   ```

1. 在主题配置文件 _config.yml 中, 启用本地搜索功能:

   ```yml
   # 使用 本地搜索 作站内搜索
   # Local search
   local_search:
     enable: true
     # if auto, trigger search by changing input
     # if manual, trigger search by pressing enter key or search button
     trigger: auto
     # show top n results per article, show all results by setting to -1
     # 显示所有结果
     top_n_per_article: -1
   ```

### 4.8 SEO

http://www.jianshu.com/p/8c0707ce5da4

#### 1 让搜索引擎收录网站

* 百度: http://zhanzhang.baidu.com/
* Google: https://www.google.com/webmasters

两者我都是用的 CNAME 域名验证。

#### 2 生成 & 提交 站点地图

**生成 站点地图**

Sitemap 是搜索引擎抓取网站要用到的, 安装插件

```sh
npm install hexo-generator-sitemap --save
```

在站点配置文件 _config.yml 中添加

```yml
sitemap:
  path: sitemap.xml
```

**提交 站点地图**

* [百度](http://zhanzhang.baidu.com/linksubmit/) 选择你的验证过的域名 -> 自动提交 -> sitemap, 添入可从互联网上访问到的你的 sitemap
* [Google](https://www.google.com/webmasters/tools/sitemap-list) 选择你的验证过的域名 -> 提交 sitemap

sitemap 站点地图只需提交一次, 成功后搜索引擎会定期的去拉取。

PS: 若是刚变动过 DNS, 可能搜索引擎会报 DNS 错误, 搜索引擎的 DNS 更新较慢, 可能要等一天(最多不超过 48 小时)。
PS: 一般 Google 提交过 sitemap 后, 第二天就可以通过搜索 `site:yourdomain.com` 搜到你的网站了。而百度...

#### 6

其中百度可以设置自动推送, 参考: https://github.com/iissnan/hexo-theme-next/issues/799

```yml
baidu_push: true
```

#### 7 为 Next 博客添加广告位

如果你的博客访问量比较大的话, 添加一个广告位也未尝不可, 若有收入则可以用来抵扣域名续费或者服务器的费用, 首先找到 themes/next/layout/_macro 下的 post.swig 文件, 在该文件中找到你认为合适放广告的位置添加如下代码

```swig
<!-- 添加广告位 -->
<div>
    {% if ! is_index %}
      {% include 'advertisement.swig' %}
    {% endif %}
</div>
```

该段代码会引入存有广告代码的文件, 新建 advertisement.swig 文件, 将你的广告代码置于其中即可。
